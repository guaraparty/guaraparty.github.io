function addSong(a,b,c,d){Player.tracks.push({artist:a,song:b,url:c,cover:d})}function getInfoFromFileName(a){a=null==a?"Unkown":a,a=a.replace(/_/g," ");var b=null==b?"Unkown":b;return-1!==a.indexOf(" - ")&&(a=a.split(" - "),b=a[0],a=a[1]),a=a.split(".")[0],{artist:b,title:a}}function playLast(){Player.loadTrack(Player.tracks.length-1),Player.play()}var songList=["5LZQ5s0kRZS9nBSd1xLK7U","4iZPNYqzI2L0uwuUKun7Aa","2wm2nAdNzutPwXRIYjwm9n","4RoOGOBrRCPTD9BXs8jVdN","4FXj4ZKMO2dSkqiAhV7L8t","2HIVSk21I9LwzrBvdvpw7K","2f7sZFUET4uJK83Kw12e1b","2eP6GhdRE1Ydnw2uXzo7q8","6JEK0CvvjDjjMUBFoXShNZ","7JD5OoA5hGBJDCBecoGlCy","6GRc7PPBY8VtTHvOvgDSuC"];songList=["5LZQ5s0kRZS9nBSd1xLK7U"];for(var Framer={countTicks:360,frequencyData:[],tickSize:10,PI:360,index:0,loadingAngle:0,init:function(a){this.scene=a,this.context=a.context,this.tickSize=this.tickSize,this.configure()},configure:function(){this.maxTickSize=9*this.tickSize*this.scene.scaleCoef,this.countTicks=434*Scene.scaleCoef},draw:function(){this.drawTicks(),this.drawEdging()},drawTicks:function(){this.context.save(),this.context.beginPath(),this.context.lineWidth=1,this.ticks=this.getTicks(this.countTicks,this.tickSize,[0,90]);for(var a=0,b=this.ticks.length;a<b;++a){var c=this.ticks[a];this.drawTick(c.x1,c.y1,c.x2,c.y2)}this.context.restore()},drawTick:function(a,b,c,d){parseInt(this.scene.cx+a),parseInt(this.scene.cy+b),parseInt(this.scene.cx+c),parseInt(this.scene.cy+d);this.context.beginPath(),this.context.strokeStyle="#ffffff",this.context.lineWidth=2,this.context.moveTo(this.scene.cx+a,this.scene.cx+b),this.context.lineTo(this.scene.cx+c,this.scene.cx+d),this.context.stroke()},setLoadingPercent:function(a){this.loadingAngle=2*a*Math.PI},drawEdging:function(){this.context.save(),this.context.beginPath(),this.context.strokeStyle="#ffffff",this.context.lineWidth=1;var a=Tracker.lineWidth/2;this.context.moveTo(this.scene.padding+2*this.scene.radius-Tracker.innerDelta-a,this.scene.padding+this.scene.radius),this.context.arc(this.scene.cx,this.scene.cy,this.scene.radius-Tracker.innerDelta-a,0,this.loadingAngle,!1),this.context.stroke(),this.context.restore()},getTicks:function(a,b,c){for(var e,f,g,h,j,k,d=this.getTickPoitns(a),i=[],l=170,m=[],n=0,o=d.length-1;n<o;++n){var p=1-n/(2.5*o);n>(d.length-1)/2&&(p=1-Math.abs(d.length-1-n)/(2.5*o));var q=((this.frequencyData[n]||0)-l*p)*this.scene.scaleCoef;if(n>(d.length-1)/2&&(q=((this.frequencyData[Math.abs(d.length-1-n)]||0)-l*p)*this.scene.scaleCoef),q=q<0?0:q,j=d[n],k=c[0]<=j.angle&&j.angle<=c[1]?this.scene.radius/(this.scene.radius-this.getSize(j.angle,c[0],c[1])-q):this.scene.radius/(this.scene.radius-(b+q)),e=j.x*(this.scene.radius-b),f=j.y*(this.scene.radius-b),g=e*k,h=f*k,i.push({x1:e,y1:f,x2:g,y2:h}),n<5){var r=q/55;r=r<1?1:r,m.push(r)}}var s=m.reduce(function(a,b){return a+b},0)/m.length;document.querySelector(".inner-canvas-wrapper").style.transform="scale("+s+")";Scene.canvas;return i},getSize:function(a,b,c){var f,d=(c-b)/2,e=a-b;if(e==d)return this.maxTickSize;var g=Math.abs(d-e),h=Math.sqrt(1/g);return f=h>this.maxTickSize?this.maxTickSize-g:Math.max(this.tickSize,h),this.index>this.count&&(this.index=0),f},getTickPoitns:function(a){for(var b=[],c=this.PI/a,d=0;d<this.PI;d+=c){var e=d*Math.PI/(this.PI/2);b.push({x:Math.cos(e),y:-Math.sin(e),angle:d})}return b}},Tracker={innerDelta:20,lineWidth:4,prevAngle:.5,angle:0,animationCount:0,pressButton:!1,init:function(a){this.scene=a,this.context=a.context,this.initHandlers()},initHandlers:function(){var a=this;this.scene.canvas.addEventListener("mousedown",function(b){a.isInsideOfSmallCircle(b)||a.isOusideOfBigCircle(b)||(a.prevAngle=a.angle,a.pressButton=!0,a.calculateAngle(b,!0))}),window.addEventListener("mouseup",function(){if(a.pressButton)var b=setInterval(function(){if(!a.animatedInProgress){a.pressButton=!1;var c=a.angle/(2*Math.PI)+.25;c=c>1?Math.abs(1-c):c,Player.audio.currentTime=c*Player.audio.duration,clearInterval(b)}},100)}),window.addEventListener("mousemove",function(b){a.animatedInProgress||a.pressButton&&a.scene.inProcess()&&a.calculateAngle(b)})},isInsideOfSmallCircle:function(a){var b=Math.abs(a.pageX-this.scene.cx-this.scene.coord.left),c=Math.abs(a.pageY-this.scene.cy-this.scene.coord.top);return Math.sqrt(b*b+c*c)<this.scene.radius-3*this.innerDelta},isOusideOfBigCircle:function(a){return Math.abs(a.pageX-this.scene.cx-this.scene.coord.left)>this.scene.radius||Math.abs(a.pageY-this.scene.cy-this.scene.coord.top)>this.scene.radius},draw:function(){this.pressButton||(this.angle=Player.audio.currentTime/Player.audio.duration*2*Math.PI||0),this.drawArc()},drawArc:function(){this.context.save(),this.context.strokeStyle="#ffffff",this.context.beginPath(),this.context.lineWidth=this.lineWidth,this.r=this.scene.radius-(this.innerDelta+this.lineWidth/2),this.context.arc(this.scene.radius+this.scene.padding,this.scene.radius+this.scene.padding,this.r,0,this.angle,!1),this.context.stroke(),this.context.restore()},calculateAngle:function(a,b){this.mx=a.pageX,this.my=a.pageY,this.angle=Math.atan((this.my-this.scene.cy-this.scene.coord.top)/(this.mx-this.scene.cx-this.scene.coord.left)),this.mx<this.scene.cx+this.scene.coord.left&&(this.angle=Math.PI+this.angle),this.angle<0&&(this.angle+=2*Math.PI),b||(this.prevAngle=this.angle)}},Scene={padding:120,minSize:740,optimiseHeight:982,_inProcess:!1,init:function(){this.canvasConfigure(),this.initHandlers(),Framer.init(this),Tracker.init(this),Controls.init(this),this.startRender()},canvasConfigure:function(){this.canvas=document.querySelector("canvas.visual"),this.context=this.canvas.getContext("2d"),this.context.strokeStyle="#FFFFFF",this.calculateSize()},calculateSize:function(){this.scaleCoef=Math.max(.5,740/this.optimiseHeight);var a=Math.max(this.minSize,1);this.canvas.setAttribute("width",a),this.canvas.setAttribute("height",a),this.width=a,this.height=a,this.radius=(a-2*this.padding)/2,this.cx=this.radius+this.padding,this.cy=this.radius+this.padding,this.coord=this.canvas.getBoundingClientRect()},initHandlers:function(){var a=this;window.onresize=function(){a.canvasConfigure(),Framer.configure(),a.render()}},render:function(){var a=this;requestAnimationFrame(function(){a.clear(),a.draw(),a._inProcess&&a.render()})},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(){Framer.draw(),Tracker.draw(),Controls.draw()},startRender:function(){this._inProcess=!0,this.render()},stopRender:function(){this._inProcess=!1},inProcess:function(){return this._inProcess}},Controls={playing:!1,init:function(a){this.scene=a,this.context=a.context,this.initHandlers(),this.timeControl=document.querySelector(".time")},initHandlers:function(){this.initPlayButton(),this.initPauseButton(),this.initSoundButton(),this.initPrevSongButton(),this.initNextSongButton(),this.initTimeHandler()},initPlayButton:function(){var a=this;this.playButton=document.querySelector(".play"),this.playButton.addEventListener("mouseup",function(){a.playButton.style.display="none",a.pauseButton.style.display="inline-block",Player.play(),a.playing=!0})},initPauseButton:function(){var a=this;this.pauseButton=document.querySelector(".pause"),this.pauseButton.addEventListener("mouseup",function(){a.playButton.style.display="inline-block",a.pauseButton.style.display="none",Player.pause(),a.playing=!1})},initSoundButton:function(){var a=this;this.soundButton=document.querySelector(".soundControl"),this.soundButton.addEventListener("mouseup",function(){a.soundButton.classList.contains("disable")?(a.soundButton.classList.remove("disable"),Player.unmute()):(a.soundButton.classList.add("disable"),Player.mute())})},initPrevSongButton:function(){var a=this;this.prevSongButton=document.querySelector(".prevSong"),this.prevSongButton.addEventListener("mouseup",function(){Player.prevTrack(),a.playing&&Player.play()})},initNextSongButton:function(){var a=this;this.nextSongButton=document.querySelector(".nextSong"),this.nextSongButton.addEventListener("mouseup",function(){Player.nextTrack(),a.playing&&Player.play()})},initTimeHandler:function(){var a=this;setTimeout(function(){var b=parseInt(Player.audio.currentTime||0),c=60,d=parseInt(b/c),e=b-d*c;d<10&&(d="0"+d),e<10&&(e="0"+e),a.timeControl.textContent=d+":"+e,a.initTimeHandler()},300)},draw:function(){this.drawPic()},drawPic:function(){this.context.save(),this.context.beginPath(),this.context.fillStyle="#ffffff",this.context.lineWidth=1;var a=Tracker.r/Math.sqrt(Math.pow(Math.tan(Tracker.angle),2)+1),b=Math.sqrt(Tracker.r*Tracker.r-a*a);2==this.getQuadrant()&&(a=-a),3==this.getQuadrant()&&(a=-a,b=-b),4==this.getQuadrant()&&(b=-b),this.context.arc(this.scene.radius+this.scene.padding+a,this.scene.radius+this.scene.padding+b,10,0,2*Math.PI,!1),this.context.fill(),this.context.restore()},getQuadrant:function(){return 0<=Tracker.angle&&Tracker.angle<Math.PI/2?1:Math.PI/2<=Tracker.angle&&Tracker.angle<Math.PI?2:Math.PI<Tracker.angle&&Tracker.angle<3*Math.PI/2?3:3*Math.PI/2<=Tracker.angle&&Tracker.angle<=2*Math.PI?4:void 0}},Player={buffer:null,duration:0,tracks:[],init:function(a){window.AudioContext=window.AudioContext||window.webkitAudioContext,this.context=new AudioContext;try{this.javascriptNode=this.context.createScriptProcessor(2048,1,1),this.javascriptNode.connect(this.context.destination),this.Player=this.context.createAnalyser(),this.Player.connect(this.javascriptNode),this.Player.smoothingTimeConstant=.7,this.Player.fftSize=2048,this.audio=document.querySelector("audio"),this.loadTrack(0),this.source=this.context.createMediaElementSource(this.audio),this.destination=this.context.destination,this.gainNode=this.context.createGain(),this.source.connect(this.gainNode),this.gainNode.connect(this.Player),this.gainNode.connect(this.destination),this.initHandlers()}catch(a){this.audio={},Framer.setLoadingPercent(1)}Scene.init()},loadTrack:function(a){var b=this.tracks[a],c=b.url;if(!c)return void alert("Song not available: "+this.tracks[a]);this.audio.src=c,this.audio.crossOrigin="anonymous",document.querySelector(".song .artist").textContent=b.artist,document.querySelector(".song .name").textContent=b.song,BackgroundCanvas.addBackground(b.cover),this.currentSongIndex=a},nextTrack:function(){this.currentSongIndex++,this.currentSongIndex==this.tracks.length&&(this.currentSongIndex=0),this.loadTrack(this.currentSongIndex)},prevTrack:function(){--this.currentSongIndex,-1==this.currentSongIndex&&(this.currentSongIndex=this.tracks.length-1),this.loadTrack(this.currentSongIndex)},play:function(){this.audio.play()},stop:function(){this.audio.stop()},pause:function(){this.audio.pause()},mute:function(){this.gainNode.gain.value=0},unmute:function(){this.gainNode.gain.value=1},initHandlers:function(){var a=this;(new Date).getTime();this.javascriptNode.onaudioprocess=function(){Framer.frequencyData=new Uint8Array(a.Player.frequencyBinCount),a.Player.getByteFrequencyData(Framer.frequencyData)},this.audio.addEventListener("progress",function(){var b=1;this.buffered.length>0&&(b=this.buffered.end(0)),a.duration=this.duration||1;var c=b/a.duration;Framer.setLoadingPercent(c)}),this.audio.addEventListener("ended",function(){Player.nextTrack(),Player.play()})}},BackgroundCanvas={addBackground:function(a){var b=document.querySelector("canvas.background"),c=b.getContext("2d");c.imageSmoothingEnabled=!1,this.img=new Image,this.img.addEventListener("load",function(){c.drawImage(this.img,0,0,b.width,b.height)}),this.img.src=a,window.coverImage=this.img,b.style.backgroundImage="url("+a+")"}},i=0;i<songList.length;i++)addSong("","","js/music.mp3",""),setTimeout(function(){Player.init()},500);
